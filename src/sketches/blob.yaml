_vars:
  TAU: &TAU 6.283185307179586

# ------------------------------------------------------------------------------
#  Corner Animations
# ------------------------------------------------------------------------------

# top-right corner
t1:
  type: triangle
  beats: 2
  phase: 0

# bottom-right corner
t2:
  type: triangle
  beats: 2
  phase: 0.25

# bottom-left corner
t3:
  type: triangle
  beats: 2
  phase: 0.5

# top-left corner
t4:
  type: triangle
  beats: 2
  phase: 0.75

outer_size:
  var: d2
  type: slider
  range: [0, 2]

outer_pos_t_mix:
  var: d3
  type: slider

# this alone adds phase cancellation to t1-4 -
# q1 moves out the most, q4 the least...
# we take advantage of that by mixing with outer_scale_2

_outer_scale_range: &outer_scale_range 1.5

outer_scale:
  type: automate
  breakpoints:
    - kind: ramp
      position: 0.0
      value: 0.0
      easing: ease_in

    - kind: ramp
      position: 2.0
      value: *outer_scale_range
      easing: ease_out

    - kind: end
      position: 4.0
      value: 0.0

outer_scale_2:
  var: d4
  type: automate
  breakpoints:
    - kind: ramp
      position: 0.0
      value: 0.0
      easing: ease_in

    - kind: ramp
      position: 3.0
      value: *outer_scale_range
      easing: ease_out

    - kind: end
      position: 6.0
      value: 0.0

outer_scale_modifier:
  type: effect
  kind: quantizer
  step: 0.25
  range: [0, 1.0]

outer_scale_mod_1:
  type: mod
  source: outer_scale
  modulators:
    - outer_scale_modifier

outer_scale_mod_2:
  type: mod
  source: outer_scale_2
  modulators:
    - outer_scale_modifier

# ------------------------------------------------------------------------------
#  Center
# ------------------------------------------------------------------------------

center_separator:
  type: separator

t_long:
  type: triangle

center_y:
  type: automate
  mode: loop
  bypass: _
  breakpoints:
    - kind: random
      position: 0.0
      value: 0.0
      amplitude: 0.0

    - kind: random
      position: 2.0
      value: 0.0
      amplitude: 2.0

    - kind: end
      position: 4.0
      value: 0.0

center_y_slew:
  type: effect
  kind: slew_limiter
  rise: 0.6
  fall: 0.6

center_y_fold_gain:
  type: triangle
  beats: 4
  range: [2, 10]

center_y_fold:
  type: effect
  kind: wave_folder
  gain: $center_y_fold_gain
  iterations: 1
  symmetry: 1.0
  bias: 0.0
  shape: -1.0
  range: [-1, 1]

center_y_mod:
  type: mod
  source: center_y
  modulators:
    - center_y_slew
    - center_y_fold

center_size:
  var: c4
  type: slider
  range: [0.25, 5]

# ------------------------------------------------------------------------------
#  Global Appearance
# ------------------------------------------------------------------------------

global_separator:
  type: separator

invert:
  type: slider
  range: [0, 1]

# center size
smoothness:
  type: slider
  range: [0, 1]

blur:
  type: slider
  range: [1, 20]

color_mix:
  type: slider

# ------------------------------------------------------------------------------
#  Un
# ------------------------------------------------------------------------------

transform_separator:
  type: separator

d1:
  type: audio
  channel: 2
  slew: [0.5, 0.5]
  detect: 0.0
  range: [0.7, 1.0]

rot_angle:
  var: e1
  type: slider
  range: [0, *TAU]

rot_speed:
  var: e2
  type: slider
  range: [0, 2]

_: _
